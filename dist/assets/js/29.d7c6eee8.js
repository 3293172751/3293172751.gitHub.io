(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{747:function(s,e,t){"use strict";t.r(e);var a=t(5),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"redis主从扩容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis主从扩容"}},[s._v("#")]),s._v(" redis主从扩容")]),s._v(" "),t("p",[s._v("[toc]")]),s._v(" "),t("p",[t("strong",[s._v("我们再加入结点主机得时候，对于新机加盟会有什么样的变化呢")])]),s._v(" "),t("p",[s._v("​")]),s._v(" "),t("h3",{attrs:{id:"新建两个结点并且启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新建两个结点并且启动"}},[s._v("#")]),s._v(" 新建两个结点并且启动")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker run -d --name redis-node-7 --net host --privileged=true \\\n-v /data/redis/share/redis-node-7:/data \\\nredis:6.0.8 --cluster-enabled yes --appendonly yes --port 6387\n\ndocker run -d --name redis-node-8 --net host --privileged=true \\\n-v /data/redis/share/redis-node-8:/data \\\nredis:6.0.8 --cluster-enabled yes --appendonly yes --port 6388\n\ndocker ps\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/05/12/gXUlwdcHPBbahsR.png",alt:"image-20220512200740037"}})]),s._v(" "),t("h3",{attrs:{id:"将新增的结点7号-空槽-作为master结点加入原集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将新增的结点7号-空槽-作为master结点加入原集群"}},[s._v("#")]),s._v(" 将新增的结点7号（空槽）作为master结点加入原集群")]),s._v(" "),t("p",[t("strong",[s._v("新的结点加入一定要重新洗牌")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker exec -it redis-node-1 /bin/bash\nredis-cli --cluster add-node 192.168.121.129:6387 192.168.121.129:6381\n#redis-cli --cluster add-node 新结点 原结点\nreids-cli --cluster check 192.168.121.129:6381 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("blockquote",[t("p",[s._v("slots进行槽位分段")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/05/12/QerPMzas1F5vpTG.png",alt:"image-20220512204012846"}})]),s._v(" "),t("p",[t("strong",[s._v("提醒我们暂时没有槽位（0，0，0），我们开始分配，使用reshard")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("redis-cli --cluster reshard 192.168.121.129:6381\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("上面我们重新分配了一个槽位")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/05/12/4jQiFxfPsTXg329.png",alt:"image-20220512204956570"}}),t("strong",[s._v("注意：此时我们需要分配槽位")])]),s._v(" "),t("blockquote",[t("p",[s._v("How many slots do you want to move (from 1 to 16384)?")]),s._v(" "),t("p",[s._v("您想移动多少个槽(从1移动到16384)?")])]),s._v(" "),t("p",[t("strong",[s._v("此时我们需要进行计算16384/4=4096（是四台master）")])]),s._v(" "),t("p",[t("strong",[s._v("接受的ID需要填6387的ID")])]),s._v(" "),t("blockquote",[t("p",[s._v("Do you want to proceed with the proposed reshard plan (yes/no)?")]),s._v(" "),t("p",[s._v("你想继续拟议的reshard计划吗(是/否)?")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/05/12/GJZbA7l5hmCEuBS.png",alt:"image-20220512205709713"}})]),s._v(" "),t("p",[t("strong",[s._v("此时我们发现槽位发生变化，每一家都润了一点给七号")])]),s._v(" "),t("p",[t("strong",[s._v("所以是以前的区间，前三家各自拿出一部分，这样可以节约分配成本")])]),s._v(" "),t("h3",{attrs:{id:"将8号挂载到7号上面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将8号挂载到7号上面"}},[s._v("#")]),s._v(" 将8号挂载到7号上面")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("redis-cli --cluster add-node 192.168.121.129:6388 192.168.121.129:6387 \\\n--cluster-slave --cluster-master-id 7号的编号\n\nredis-cli --cluster check 192.168.121.129:6387\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/05/12/bLF4Xw6vt2yh8Cr.png",alt:"image-20220512210521860"}})]),s._v(" "),t("p",[t("strong",[s._v("此时扩容成功！！！")])])])}),[],!1,null,null,null);e.default=r.exports}}]);