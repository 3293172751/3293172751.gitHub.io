(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{752:function(s,e,t){"use strict";t.r(e);var a=t(5),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"bridge是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bridge是什么"}},[s._v("#")]),s._v(" bridge是什么")]),s._v(" "),t("p",[s._v("[toc]")]),s._v(" "),t("h2",{attrs:{id:"bridge是什么-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bridge是什么-2"}},[s._v("#")]),s._v(" bridge是什么")]),s._v(" "),t("p",[s._v("Docker 服务默认会创建一个 docker0 网桥（其上有一个 docker0 内部接口），该桥接网络的名称为docker0，"),t("strong",[s._v("它在内核层连通了其他的物理或虚拟网卡，这就将所有容器和本地主机都放到同一个物理网络。Docker 默认指定了 docker0 接口 的 IP 地址和子网掩码，==让主机和容器之间可以通过网桥相互通信。==")])]),s._v(" "),t("blockquote",[t("p",[s._v("网桥就是docker0，宿主机和容器之间通信需要网桥，容器与容器通信也要网桥")])]),s._v(" "),t("h2",{attrs:{id:"查看-bridge-网络的详细信息-并通过-grep-获取名称项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看-bridge-网络的详细信息-并通过-grep-获取名称项"}},[s._v("#")]),s._v(" 查看 bridge 网络的详细信息，并通过 grep 获取名称项")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('root@ubuntu:/# docker network inspect bridge | grep name\n            "com.docker.network.bridge.name": "docker0",\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("config")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("root@ubuntu:/# ifconfig\ndocker0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255\n        inet6 fe80::42:1cff:fea2:e40d  prefixlen 64  scopeid 0x20<link>\n        ether 02:42:1c:a2:e4:0d  txqueuelen 0  (Ethernet)\n        RX packets 6300  bytes 262863 (262.8 KB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 6448  bytes 44884020 (44.8 MB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.121.129  netmask 255.255.255.0  broadcast 192.168.121.255\n        inet6 fe80::b367:9300:1119:6132  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:28:be:81  txqueuelen 1000  (Ethernet)\n        RX packets 496051  bytes 650135348 (650.1 MB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 111754  bytes 9680017 (9.6 MB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"案例说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例说明"}},[s._v("#")]),s._v(" 案例说明")]),s._v(" "),t("p",[s._v("1 Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在"),t("strong",[s._v("同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的Container-IP直接通信。")])]),s._v(" "),t("p",[s._v("2 docker run 的时候，**没有指定network的话默认使用的网桥模式就是bridge，使用的就是docker0。**在宿主机ifconfig,就可以看到docker0和自己create的network(后面讲)eth0，eth1，eth2……代表网卡一，网卡二，网卡三……，lo代表127.0.0.1，即localhost，inet addr用来表示网卡的IP地址")]),s._v(" "),t("p",[t("strong",[s._v("3. 网桥docker0创建一对对等虚拟设备接口一个叫veth，另一个叫eth0，成对匹配。")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("整个宿主机的网桥模式都是docker0，类似一个交换机有一堆接口，每个接口叫veth，在本地主机和容器内分别创建一个虚拟接口，并让他们彼此联通（这样一对接口叫veth pair）；")])]),s._v(" "),t("li",[t("p",[s._v("每个容器实例内部也有一块网卡，"),t("strong",[s._v("每个接口叫eth0；")])])]),s._v(" "),t("li",[t("p",[s._v("docker0上面的每个veth匹配某个容器实例内部的"),t("strong",[s._v("eth0，两两配对，一一匹配。")])])])]),s._v(" "),t("p",[t("strong",[s._v("通过上述，将宿主机上的所有容器都连接到这个内部网络上，两个容器在同一个网络下,会从这个网关下各自拿到分配的ip，此时两个容器的网络是互通的。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/05/14/L7nUF49qlckbRph.jpg",alt:"graphic"}})]),s._v(" "),t("blockquote",[t("p",[s._v("网桥就是docker0，宿主机和容器之间通信需要网桥，容器与容器通信也要网桥")])]),s._v(" "),t("p",[s._v("代码")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker run -d -p 8081:8080  --name tomcat81 billygoo/tomcat8-jdk8\n\ndocker run -d -p 8082:8080  --name tomcat82 billygoo/tomcat8-jdk8\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("两两匹配验证")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("root@ubuntu:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps |grep tomcat")]),s._v("\n518bce78283a   billygoo/tomcat8-jdk8   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"catalina.sh run"')]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" seconds                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:8082-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp, :::8082-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp   tomcat82\n98ec1a7378a7   billygoo/tomcat8-jdk8   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"catalina.sh run"')]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" seconds                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:8081-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp, :::8081-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp   tomcat81\nroot@ubuntu:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip addr |tail -n 8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(": veth7ad0904@if24: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue master docker0 state UP group default \n    link/ether 06:dd:54:bd:8b:4b brd ff:ff:ff:ff:ff:ff link-netnsid "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    inet6 fe80::4dd:54ff:febd:8b4b/64 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" \n       valid_lft forever preferred_lft forever\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(": vethb119ebb@if26: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue master docker0 state UP group default \n    link/ether "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("76")]),s._v(":40:af:cd:83:b8 brd ff:ff:ff:ff:ff:ff link-netnsid "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n    inet6 fe80::7440:afff:fecd:83b8/64 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" \n       valid_lft forever preferred_lft forever\nroot@ubuntu:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat81 bash")]),s._v("\nroot@98ec1a7378a7:/usr/local/tomcat"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip addr")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(": eth0@if25: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff link-netnsid "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.5/16 brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".255.255 scope global eth0\n       valid_lft forever preferred_lft forever\nroot@98ec1a7378a7:/usr/local/tomcat"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\nroot@ubuntu:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat82 bash")]),s._v("\nroot@518bce78283a:/usr/local/tomcat"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip addr")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(": eth0@if27: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:06 brd ff:ff:ff:ff:ff:ff link-netnsid "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.6/16 brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/05/14/JeaFpNfcnDSr7s2.jpg",alt:"graphic"}})]),s._v(" "),t("p",[t("strong",[s._v("由此可见：")])]),s._v(" "),t("ul",[t("li",[s._v("veth7ad0904@if24和eth0@if25成对出现")]),s._v(" "),t("li",[s._v("vethb119ebb@if26和eth0@if27成对出现")])]),s._v(" "),t("blockquote",[t("p",[s._v("验证了网桥docker0创建一对对等虚拟设备接口一个叫veth，另一个叫eth0，成对匹配。")])])])}),[],!1,null,null,null);e.default=r.exports}}]);